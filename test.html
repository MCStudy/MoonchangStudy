<html>
  <head>

  </head>
<body>

<canvas id="canvas" width=800 height=600></canvas>

</body>
<!-- server -->
<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<script>

var insertRank = function(player, score){
  $.ajax({
    dataType: 'jsonp',
    data: 'rank={"player":"'+player+'", "score":"'+score+'"}',
    jsonp: 'callback',
    url: 'http://nupa.fun25.co.kr:17903/insert?callback=?',
    success: function(data) {
      console.log(data);
    }
  });
};

var viewRank = function(){
  $.ajax({
    dataType: 'jsonp',
    jsonp: 'callback',
    url: 'http://nupa.fun25.co.kr:17903/view',
    success: function(data) {
      console.log(data);
    }
  });
};

</script>

<!-- game -->
<script src="lib/engine.js"></script>
<script src="monster/Weed.js"></script>
<script src="monster/Bat.js"></script>
<script src="monster/Mouse.js"></script>
<script src="monster/Beetle.js"></script>
<script src="monster/Piece.js"></script>
<script src="map/Map.js"></script>

<script>

var player;
var level;
setInterval(function(){
  Camera.set();
}, 10);

var gameStart = function(lv){
  level = lv || 1;

  for(var i in sprites){
    sprites[i].dead();
  }
  initMap();

  player = new Sprite(function(my){

    my.width = 32;
    my.height = 40;

    my.gravity = true;
    my.tag = 'player';
    my.moveSpeed = 20;
    my.havepiece = 0;

    my.animate('img/uzuki.png', 133, 191, {
      left: 2,
      leftRun: 3,
      leftJump: 4,
      right: 0,
      rightRun: 1,
      rightJump: 4
    }, 8);

    my.onDead(function(){
      setTimeout(gameStart, 100);
    });

    my.remove('crashes');
    my.onCrash(function(direction, target){

      if(target.tag == 'ball'){
        my.dead();
        return;
      }
      if(target.tag == 'branch'){
        if(direction=='bottom' && my.ay>0 && (my.y+my.height)<target.y+10){
          my.y = target.y - my.height;
          my.ay = 0;
          my.jump = false;
          setTimeout(function(){
            target.dead();
          },1000)
          setTimeout(function(){
            target.draw();
          },3000)
        }
      }
      else{
        switch(direction){
          case 'bottom':
            my.y = target.y - my.height;
            my.ay = 0;
            my.jump = false;
          break;
          case 'top':
            my.y = target.y + target.height;
            my.ay = 0;
          break;
          case 'right': my.x = target.x - my.width; break;
          case 'left': my.x = target.x + target.width; break;
        }
      }

    });

  }).draw(100,200);

/*
  new Weed(600,300);
  new Weed(900,300);
  new Weed(1200,300);*/
  new Bat(800,400);
/*
  new Mouse(500,400,20);
  new Mouse(700,400,15);
  new Mouse(300,400);
  new Mouse(300,400,17,30,30);
  new Beetle(4450, 400);
*/
  new Piece(1300, 450);
  new Piece(3150, 300);
  new Piece(4100, 200);
  new Piece(5600, 200);

  Camera.target = player;
};

if(confirm( 'play game?' ))
  gameStart();

</script>
</html>
