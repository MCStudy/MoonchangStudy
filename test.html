<html>
  <head>

  </head>
<body>

<canvas id="canvas" width=800 height=600></canvas>

</body>
<script src="lib/engine.js"></script>
<script>





var player = new Sprite(function(my){

  my.width = 32;
  my.height = 32;

  my.gravity = true;
  my.tag = 'player';
  my.moveSpeed = 10;

  my.animate('pikachu.png', 18, 18, {
    left: 0,
    leftRun: 1,
    leftJump: 0,
    right: 0,
    rightRun: 2,
    rightJump: 0
  }, 4);


  my.onCrash(function(direction, target){
      if(target.tag == 'ball'){
        my.dead();
      }else{
        target.renderer(function(){
          ctx.beginPath();
          ctx.fillStyle = "rgba(0,0,0,100)";
          ctx.rect(target.x, target.y, target.width, target.height);
          ctx.fill();
        });
      }
  });

}).draw(100,200);




var grass = new Sprite(function(my){

  my.width = 32;
  my.height = 32;

  my.gravity = true;

  my.animate('pikachu.png', 18, 18, {
    left: 0,
    leftRun: 1,
    leftJump: 0,
    right: 0,
    rightRun: 2,
    rightJump: 0
  }, 4);

  my.remove('crashes');

  my.onCrash(function(direction, target){

    if(target.tag == 'player'){
      my.dead();
    }


    if(target.tag=='ball') return;

    switch(direction){
      case 'bottom':
        my.y = target.y - my.height;
        my.ay = 0;
        my.jump = false;
      break;
      case 'top':
        my.y = target.y + target.height;
        my.ay = 0;
      break;
      case 'left': my.x = target.x - my.width; break;
      case 'right': my.x = target.x + target.width; break;
    }

  });

}).draw(730,400);


var grass2 = new Sprite(function(my){

  my.width = 32;
  my.height = 32;

  my.gravity = false;

  my.animate('pikachu.png', 18, 18, {
    left: 0,
    leftRun: 1,
    leftJump: 0,
    right: 0,
    rightRun: 2,
    rightJump: 0
  }, 4);

  my.remove('crashes');

  my.onCrash(function(direction, target){

    if(target.tag == 'player'){
      my.dead();
    }


    if(target.tag=='ball') return;

    switch(direction){
      case 'bottom':
        my.y = target.y - my.height;
        my.ay = 0;
        my.jump = false;
      break;
      case 'top':
        my.y = target.y + target.height;
        my.ay = 0;
      break;
      case 'left': my.x = target.x - my.width; break;
      case 'right': my.x = target.x + target.width; break;
    }

  });

}).draw(720,300);


var ball = [];
setInterval(function(){
  if(sprites[grass.id] && sprites[player.id]){    // 잡초와 플레이어가 존재할때만
    ball.push(new Sprite(function(my){

      my.width = 20;
      my.height = 20;
      my.tag = 'ball';

      my.xup = grass.x - player.x;
      my.yup = grass.y - player.y;

      my.distance = Math.sqrt(Math.pow(my.xup, 2) + Math.pow(my.xup, 2));

      my.xvec = my.xup/my.distance;
      my.yvec = my.yup/my.distance;

      my.gravity = false;

      my.update(function(){
        my.x -= my.xvec;
        my.y -= my.yvec;

      });

      my.renderer(function(){
        my.img = new Image();
        my.img.src = 'a.png';
        ctx.drawImage(my.img, my.x, my.y, my.width, my.height);
      });

      my.remove('crashes');


    }).draw(grass.x, grass.y));
  }
}, 2000);


setInterval(function(){
  if(sprites[grass2.id] && sprites[player.id]){    // 잡초와 플레이어가 존재할때만
    ball.push(new Sprite(function(my){

      my.width = 20;
      my.height = 20;
      my.tag = 'ball';

      my.xup = grass2.x - player.x;
      my.yup = grass2.y - player.y;

      my.distance = Math.sqrt(Math.pow(my.xup, 2) + Math.pow(my.xup, 2));

      my.xvec = my.xup/my.distance;
      my.yvec = my.yup/my.distance;

      my.gravity = false;

      my.update(function(){
        my.x -= my.xvec;
        my.y -= my.yvec;

      });

      my.renderer(function(){
        my.img = new Image();
        my.img.src = 'a.png';
        ctx.drawImage(my.img, my.x, my.y, my.width, my.height);
      });

      my.remove('crashes');


    }).draw(grass2.x, grass2.y));
  }
}, 2500);



for(var i=0; i<20; i++){
  new Sprite(function(my){
    my.width = 50;
    my.height = 50;
    my.static = true;

    my.renderer(function(){
      ctx.beginPath();
        ctx.fillStyle = "rgba(0,0,0,100)";
        ctx.rect(my.x, my.y, my.width, my.height);
        ctx.stroke();
    });

    my.draw(i*(my.width+40), 500);

  });
}



</script>
</html>
